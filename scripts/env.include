#!/bin/bash

update_env(){
if test -f /env.yml; then
  x=$(cat /env.yml | flatten_yaml.py)
elif test $(curl --check 200 http://169.254.169.254/latest/user-data); then
  x=$(curl http://169.254.169.254/latest/user-data | flatten_yaml.py)
elif test $(curl some magic to compute engine); then
  x=$(computeengine user-data get | flatten_yaml.py)
fi

err=$?

if test err -ne 0; then
  echo "error"
fi

if x:
  for key,value in x:
    if key not exist:
        key=value
}
