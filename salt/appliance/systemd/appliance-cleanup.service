[Unit]
Description=Appliance Cleanup
Requires=docker.service appliance.service
PartOf=appliance.service
After=appliance.service
ReloadPropagatedFrom=appliance.service

[Service]
Type=oneshot
Environment=UNITNAME=%n
ExecStart=/bin/bash -c "sleep 30; \
  docker-compose -f /etc/appliance/ecs/docker-compose.yml rm -v -f; \
  docker rmi --force $(docker images -q --filter 'dangling=true')"
ExecReload=/bin/true
RemainAfterExit=on

[Install]
WantedBy=multi-user.target
