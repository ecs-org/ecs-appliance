# Virtualhost Client http(s)://%(hostname)s

#NameVirtualhost %(ip)s:443

<VirtualHost *:443>
    ServerName %(hostname)s
    ServerAlias *.%(hostname)s
    ServerAdmin postmaster@%(hostname)s

    SSLEngine on
    SSLCertificateFile "/etc/ssl/certs/%(hostname)s.pem"
    SSLCertificateChainFile "/etc/ssl/%(hostname)s.chain.pem"
    SSLCertificateKeyFile "/etc/ssl/private/%(hostname)s.key"

    SSLCACertificateFile "%(ca_certificate_file)s"
    SSLCARevocationFile "%(ca_revocation_file)s"
    SSLVerifyClient none

    # intermediate configuration, according to https://mozilla.github.io/server-side-tls/ssl-config-generator/
    SSLProtocol             all -SSLv2 -SSLv3
    SSLCipherSuite          ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
    SSLHonorCipherOrder     on

    <Location /secure>
        SSLRequireSSL
        SSLVerifyClient require
        SSLVerifyDepth 1
    </Location>

    DocumentRoot %(home)s/empty_html
    <Directory "%(home)s/empty_html">
        Options FollowSymLinks
        AllowOverride Authconfig FileInfo Indexes Limit Options=Indexes
    </Directory>

    Include /etc/apache2/ecs/apache.conf/*.conf
</VirtualHost>

<VirtualHost %(hostname)s:80>
    ServerName %(hostname)s
    ServerAdmin postmaster@%(hostname)s

    DocumentRoot %(home)s/empty_html
    <Directory "%(home)s/empty_html">
        Options FollowSymLinks
        AllowOverride Authconfig FileInfo Indexes Limit Options=Indexes
    </Directory>

    Redirect permanent / https://%(hostname)s/
</VirtualHost>
